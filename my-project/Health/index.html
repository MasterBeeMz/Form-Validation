<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>แบบสอบถามสุขภาพ พร้อมไอคอน</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Sarabun', sans-serif;
    background: linear-gradient(135deg, #c3dafe 0%, #e9d8fd 100%);
  }
  input:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px #a78bfa;
    border-color: #a78bfa;
  }
  .error-text {
    color: #dc2626;
    font-size: 0.875rem;
  }
  #diseaseDetail {
    transition: max-height 0.3s ease, opacity 0.3s ease;
    max-height: 0;
    opacity: 0;
    overflow: hidden;
  }
  #diseaseDetail.show {
    max-height: 200px;
    opacity: 1;
  }
  #modalBackdrop {
    backdrop-filter: blur(6px);
  }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <form id="healthForm" class="bg-white rounded-xl shadow-lg max-w-md w-full p-8 space-y-6">
    <h1 class="text-3xl font-semibold text-center text-indigo-700 mb-6">แบบสอบถามสุขภาพ</h1>

    <div class="flex flex-col">
      <label for="age" class="block text-gray-700 font-medium mb-1 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12a9 9 0 11-9 9" />
        </svg>
        อายุ (ปี)
      </label>
      <input type="number" id="age" name="age" placeholder="15 - 60" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
      <p id="ageError" class="error-text hidden mt-1"></p>
    </div>

    <div class="flex flex-col">
      <label class="block text-gray-700 font-medium mb-1 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c3.866 0 7.372 1.516 10 4" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        เพศ
      </label>
      <div class="flex gap-6 text-gray-700">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="radio" name="gender" value="ชาย" class="w-5 h-5 accent-indigo-500" />
          ชาย
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="radio" name="gender" value="หญิง" class="w-5 h-5 accent-indigo-500" />
          หญิง
        </label>
      </div>
      <p id="genderError" class="error-text hidden mt-1"></p>
    </div>

    <div class="flex flex-col">
      <label for="weight" class="block text-gray-700 font-medium mb-1 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.5 0-4.5 3-4.5 4.5S12 17 12 17s4.5-3 4.5-4.5S13.5 8 12 8z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l3 3 3-3" />
        </svg>
        น้ำหนัก (กก.)
      </label>
      <input type="number" id="weight" name="weight" placeholder="เช่น 60" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
      <p id="weightError" class="error-text hidden mt-1"></p>
    </div>

    <div class="flex flex-col">
      <label for="height" class="block text-gray-700 font-medium mb-1 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h8" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v8" />
        </svg>
        ส่วนสูง (ซม.)
      </label>
      <input type="number" id="height" name="height" placeholder="เช่น 170" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
      <p id="heightError" class="error-text hidden mt-1"></p>
    </div>

    <div class="flex flex-col">
      <label class="inline-flex items-center gap-2 cursor-pointer mt-4 text-gray-700 font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 20a8 8 0 100-16 8 8 0 000 16z" />
        </svg>
        <input type="checkbox" id="hasDisease" class="w-5 h-5 accent-indigo-600" />
        <span>มีโรคประจำตัว</span>
      </label>
      <textarea id="diseaseDetail" placeholder="โปรดระบุรายละเอียดโรคประจำตัว" class="w-full px-4 py-2 mt-2 border border-gray-300 rounded-lg resize-none"></textarea>
      <p id="diseaseError" class="error-text hidden mt-1"></p>
    </div>

    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 transition-colors text-white font-semibold py-3 rounded-lg text-lg">ส่งแบบสอบถาม</button>
  </form>

  <!-- Modal -->
  <div id="modalBackdrop" class="fixed inset-0 bg-black bg-opacity-30 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-xl max-w-sm w-full p-6 shadow-lg text-center space-y-4">
      <h2 class="text-2xl font-bold text-indigo-700">ผลการประเมิน BMI</h2>
      <p id="bmiResult" class="text-gray-700 text-lg"></p>
      <button id="closeModal" class="mt-4 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold transition">ปิด</button>
    </div>
  </div>

  <style>
    input:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px #a78bfa;
      border-color: #a78bfa;
    }
    .error-text {
      color: #dc2626;
      font-size: 0.875rem;
    }
    #diseaseDetail {
      transition: max-height 0.3s ease, opacity 0.3s ease;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }
    #diseaseDetail.show {
      max-height: 200px;
      opacity: 1;
    }
    #modalBackdrop {
      backdrop-filter: blur(6px);
    }
  </style>

  <script>
    const form = document.getElementById('healthForm');
    const hasDisease = document.getElementById('hasDisease');
    const diseaseDetail = document.getElementById('diseaseDetail');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const bmiResult = document.getElementById('bmiResult');
    const closeModalBtn = document.getElementById('closeModal');

    // เริ่มซ่อน textarea
    diseaseDetail.classList.remove('show');
    diseaseDetail.style.maxHeight = '0px';
    diseaseDetail.style.opacity = '0';

    hasDisease.addEventListener('change', () => {
      if (hasDisease.checked) {
        diseaseDetail.classList.add('show');
        diseaseDetail.style.maxHeight = diseaseDetail.scrollHeight + "px";
        diseaseDetail.style.opacity = '1';
      } else {
        diseaseDetail.classList.remove('show');
        diseaseDetail.style.maxHeight = '0px';
        diseaseDetail.style.opacity = '0';
        diseaseDetail.value = '';
        document.getElementById('diseaseError').classList.add('hidden');
      }
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // เคลียร์ error ก่อน
      ['ageError','genderError','weightError','heightError','diseaseError'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
        document.getElementById(id).textContent = '';
      });

      let valid = true;

      const age = parseInt(form.age.value);
      const gender = form.gender.value;
      const weight = parseFloat(form.weight.value);
      const height = parseFloat(form.height.value);
      const diseaseText = diseaseDetail.value.trim();

      if (isNaN(age) || age < 15 || age > 60) {
        const el = document.getElementById('ageError');
        el.textContent = 'กรุณากรอกอายุระหว่าง 15 - 60 ปี';
        el.classList.remove('hidden');
        valid = false;
      }
      if (!gender) {
        const el = document.getElementById('genderError');
        el.textContent = 'กรุณาเลือกเพศ';
        el.classList.remove('hidden');
        valid = false;
      }
      if (isNaN(weight) || weight <= 0) {
        const el = document.getElementById('weightError');
        el.textContent = 'กรุณากรอกน้ำหนักเป็นค่าบวก';
        el.classList.remove('hidden');
        valid = false;
      }
      if (isNaN(height) || height <= 0) {
        const el = document.getElementById('heightError');
        el.textContent = 'กรุณากรอกส่วนสูงเป็นค่าบวก';
        el.classList.remove('hidden');
        valid = false;
      }
      if (hasDisease.checked && diseaseText === '') {
        const el = document.getElementById('diseaseError');
        el.textContent = 'กรุณาระบุโรคประจำตัว';
        el.classList.remove('hidden');
        valid = false;
      }

      if (!valid) return;

      const bmi = weight / ((height/100)**2);
      let category = '';
      if (bmi < 18.5) category = 'น้ำหนักน้อย';
      else if (bmi < 24.9) category = 'ปกติ';
      else if (bmi < 29.9) category = 'น้ำหนักเกิน';
      else category = 'อ้วน';

      bmiResult.textContent = `ค่า BMI ของคุณคือ ${bmi.toFixed(2)} อยู่ในหมวดหมู่ "${category}"`;

      modalBackdrop.classList.remove('hidden');
      form.reset();
      diseaseDetail.classList.remove('show');
      diseaseDetail.style.maxHeight = '0px';
      diseaseDetail.style.opacity = '0';
    });

    closeModalBtn.addEventListener('click', () => {
      modalBackdrop.classList.add('hidden');
    });
  </script>

</body>
</html>
